---
title: "AutomationCredential"
author: "Larry Liu"
date: "10/17/2025"
output: html_document
---

```{r}
library(remotes)
library(pdftools)
library(readr)
library(stargazer)
library(ggplot2)
library(gridExtra)
library(VIM)
```

```{r}
setwd("~/Documents/ResearchProjects/AutomationCredentials")

soccode<-c('11-1021', '11-3071', '11-9013', '11-9051', '11-9081', '11-9111', 
           '11-9141', '11-9151', '13-1011', '13-2021', '13-1051', '13-1021',
           '13-1131', '13-1032', '13-1071', '13-1075', '13-2071', '13-1081',
           '13-2052', '13-2072', '13-2081', '13-2082', '13-1151', '15-1111',
           '15-1151', '15-1152', '17-1021', '17-1022', '17-3011','17-3012', 
           '17-3013',
           '17-3019', '17-3021', '17-3022', '17-3023', '17-3024', '17-3025',
           '17-3031', '17-3026', '19-1011', '19-1012', '19-1013', '19-1021',
           '19-1022', '19-1023', '19-1031', '19-1041', '19-1042', '19-1099',
           '19-2012', '19-2021', '19-2031', '19-2032', '19-2042', '19-2043',
           '19-3011', '19-3051', '19-4011', '19-4021', '19-4031', '21-1011',
           '21-1013', '21-1014', '21-1015', '21-1019', '21-1021', '21-1023',
           '21-1029', '21-1091', '21-1093', '21-1094', '21-1099', '21-2021',
           '23-1012', '23-2091', '23-2093', '23-2099', '25-3021', '25-3099',
           '25-4011', '25-4012', '25-4013', '25-4021', '25-4031', '25-9011',
           '25-9021', '25-9031', '27-1027', '27-3031', '27-3091', '27-4031',
           '27-4032', '29-1124', '29-1126', '29-1129', '29-1141', '29-2012',
           '29-2021', '29-2032', '29-2033', '29-2034', '29-2053', '29-2054',
           '29-2061', '31-1013', '33-1011', '33-1012', '33-1021', '33-1099',
           '33-2021', '33-2021', '33-3052', '33-9021', '33-9031', '35-1012',
           '37-1012','39-1021', '39-9011', '41-3011', '41-2021', '41-4012',
           '41-1012','41-1011', '41-3021', '41-9011', '41-9021', '41-3099',
           '41-9022', '41-3031',
           '41-9041', '41-3041', '43-3031', '43-3061', '43-4011', '43-9011',
           '43-4031', '43-4041', '43-4061', '43-5011', '43-3099', '43-1011',
           '43-4161', '43-9041', '43-4111', '43-5031', '43-4131', '43-9199',
           '43-3051', '43-6011', '43-6012', '43-5061', '43-6014', '43-9111',
           '45-1011', '45-2011', '45-4011', '45-4023', '45-4029', '47-2161',
           '47-1011', '47-4011', '47-4041', '47-5031', '49-1011', '49-2011',
           '51-3022', '51-4032', '51-4062', '51-1011', '51-8031', '51-9061',
           '51-4071', '51-4081', '51-5111', '51-6052', '51-6061', '51-6092',
           '51-6099', '51-8011', '51-8012', '51-8013', '51-8091', '51-8092',
           '51-9021', '51-9051', '51-9083', '51-9141', '51-9151', '51-9198',
           '53-2021', '53-2022', '53-4099', '53-5021', '53-5031', '53-6041',
           '53-6099')
credgap<-c(20,42,45,24,17,5,26,1,1,11,31,24,-9,7,20,17,11,28,-4,15,7,-5,25,
           -30,21,31,-20,-26,14,21,12,17,38,20,11,13,27,25,20,-22,-4,-14,
           -40,-24,-30,-20,-28,-29,-18,-60,-4,-21,-38,-22,-22,-52,-21,36,9,
           18,-21,-40,-27,-15,-11,-10,-33,-42,-2,9,-15,11,8,-40,-15,20,26,
           7,24,-32,-26,-19,-46,-6,-33,-6,1,15,-5,-6,9,21,14,16,-29,-16,-18,
           7,8,31,4,23,11,23,31,28,11,25,17,5,17,-4,9,11,21,37,10,12,9,16,20,
           23,22,-8,19,-4,17,0,-17,19,0,18,23,-1,1,11,40,12,16,32,29,22,24,5,
           15,0,10,24,46,20,16,15,24,26,9,17,69,22,53,21,4,18,22,34,23,31,26,
           36,45,18,22,41,28,20,28,26,25,14,12,28,10,39,33,35,19,18,22,14,21,
           11,26,24,42,57,21,38)
credgapdata<-data.frame(soccode, credgap)
write.csv(credgapdata, "credgapdata.csv")

##load occupationdata1
occupationdata1<-read.csv("occupationdata1.csv")

##create average score by soccode
occupationdata2<-occupationdata1%>%
  group_by(soccode)%>%
  summarize(gmyrek_score=mean(mean_score),
            medianage=mean(medianage),
            totalemp=mean(totalemp),
            womenpct=mean(womenpct),
            whitepct=mean(whitepct),
            blackpct=mean(blackpct),
            asianpct=mean(asianpct),
            hispanicpct=mean(hispanicpct),
            medianwagefull=mean(medianwagefull))
write.csv(occupationdata2, "occupationdata2.csv")

##load freyosborne
freydata<-read_excel("freyosborne.xlsx")
freydata1<-freydata%>%rename(freyosb=computerizationprob,
                             soccode=soc10)%>%
  select(freyosb, soccode)

##merge occupationdata, freydata
credgapdata1<-left_join(occupationdata2,freydata1, by=c("soccode"= "soccode"))

##check duplicated
#duplicated_soccodes <- occupationdata2 %>%
#  dplyr::count(soccode) %>%
#  dplyr::filter(n > 1)
#print(duplicated_soccodes)

##merge credgapdata with credgapdata
credgapdata1<-left_join(credgapdata1,credgapdata,by=c("soccode"= "soccode"))

##keep only complete observations for credgap
credgapdata2<-credgapdata1%>%
  filter(!is.na(credgap))%>%
  mutate(gmyrek_score100=gmyrek_score*100,
         freyosb100=freyosb*100)

colMeans(is.na(credgapdata2)) * 100

##Descriptive stats
credgapdescriptive<-credgapdata2%>%
  dplyr::select(gmyrek_score100,freyosb100,credgap, medianage, totalemp,
         womenpct,whitepct, medianwagefull)
credgapdescriptive<-as.data.frame(credgapdescriptive)

##find the 10 lowest credgap, and highest
# Get the 10 observations with the lowest `value`
lowest_10 <- credgapdata2 %>%
  slice_min(freyosb100, n = 10)
lowest_10
# Get the 10 observations with the highest `value`
highest_10 <- credgapdata2 %>%
  slice_max(freyosb100, n = 10)
highest_10
```

## Regression

```{r}
##base models
freycred_base<-lm(credgap~freyosb100, data=credgapdata2)
gmyrekcred_base<-lm(credgap~gmyrek_score100, data=credgapdata2)

##full models
freycred_full<-lm(credgap~freyosb100+medianage+totalemp+womenpct+whitepct+
                    medianwagefull, data=credgapdata2)
gmyrekcred_full<-lm(credgap~gmyrek_score100+medianage+totalemp+womenpct+whitepct+
                      medianwagefull, data=credgapdata2)
```

##stargazer output

```{r}
stargazer(credgapdescriptive,
          type="html",
          digits=2,
          covariate.labels = c("Gmyrek AI","FreyOsborne Computerization",
                               "Credential Gap",
                               "Median Age", "Total Emp", "% Women",
                               "% White", "Median Wage Weekly"),
          out="descriptivestat.htm",
          title="Descriptive Statistics: Credential Gap and Automation"
          )
```


```{r}
stargazer(freycred_base, gmyrekcred_base, freycred_full, gmyrekcred_full,
          title="Credential Gap and Automation",
          type="html",
          digits=2,
          out="regression.htm",
          dep.var.labels = "Credential Gap",
          covariate.labels = c("FreyOsborne Computerization","Gmyrek AI",
                               "Median Age", "Total Emp", "% Women",
                               "% White", "Median Wage Weekly"))
```

## Scatterplot

```{r}
cor(credgapdata2$gmyrek_score100,credgapdata2$credgap,use="complete.obs")
corplotAI<-ggplot(data=credgapdata2,aes(x=credgap,y=gmyrek_score100))+geom_point()+
  xlab("Credential Gap")+ylab("Gmyrek AI exposure")+
  ggtitle("r=-0.02")

cor(credgapdata2$freyosb100,credgapdata2$credgap, use="complete.obs")
corplotcomp<-ggplot(data=credgapdata2,aes(x=credgap,y=freyosb100))+geom_point()+
  xlab("Credential Gap")+ylab("FreyOsborne Computerization")+
  ggtitle("r=0.23")
corplot<-grid.arrange(corplotAI, corplotcomp, ncol=2)

ggsave("corplot.png", corplot, width=14, height=7)
```

